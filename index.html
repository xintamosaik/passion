<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link rel="stylesheet" href="reset.css">
    <link rel="stylesheet" href="base.css">
    <style>
        main {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        card-space {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 100%;
            min-width: 80%;
            background-color: darkolivegreen;
            border: 1px solid black;
            border-radius: 20px;
            padding: 20px;
            margin: 10px;
        }

        swipe-card {
            display: block;


            /*aspect ratio like a usual card*/
            aspect-ratio: 1 / 1.5;
            background-color: var(--color-background);
            border-radius: 20px;
            padding: 20px;
            margin: 10px;
            transform-origin: bottom center;
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            console.log('DOM is ready');

            setInterval(showTime, 1000);

            const deviceWidth = window.innerWidth;
            const deviceHeight = window.innerHeight;

            let holdPosition = null;
            let holdTime = null;
            let holdTimeEnd = null;
            let holdTimeStart = null;
            let holdTimeTotal = null;
            let holdPositionEnd = null;
            let cardHold = false;

            const MAX_ROTATION = 33;
            const MAX_DISTANCE = deviceWidth / 2;

            const MAIN = document.querySelector('main');

            const SWIPE_CARD = document.querySelector('swipe-card');
            SWIPE_CARD.addEventListener('click', function () {
                console.log('Card clicked');
            });

            function registerSwipeStart(positionX) {
                MAIN.style.backgroundColor = `hsl(0, 0%, 0%)`;
                holdPosition = positionX
                holdTimeStart = new Date();
                cardHold = true;
            }
            SWIPE_CARD.addEventListener('touchstart', function (e) {
                console.log('started holding card');
                registerSwipeStart(e.touches[0].clientX);
            });

            function observeMouseMove (e) {
                if (!cardHold) {
                    return;
                }
                observeSwipe(e.clientX);
            }

            SWIPE_CARD.addEventListener('mousedown', function (e) {
                console.log('started holding card');
                registerSwipeStart(e.clientX);
                SWIPE_CARD.addEventListener('mousemove', observeMouseMove);
            });
            

           

            function observeSwipe(positionX) {
                if (!cardHold) {
                    return;
                }

                holdPositionEnd = positionX
                

                const HOLD_DISTANCE = holdPositionEnd - holdPosition;
                const ROTATE_DEGREE = HOLD_DISTANCE / MAX_DISTANCE * 45;
                const ROTATE_DEGREE_ABS = Math.abs(ROTATE_DEGREE);
                const TOO_MUCH_ROTATION = ROTATE_DEGREE_ABS > MAX_ROTATION;
                const ROTATION_DIRECTION = ROTATE_DEGREE > 0 ? 1 : -1;
                const CARD_ROTATION = TOO_MUCH_ROTATION ? MAX_ROTATION * ROTATION_DIRECTION : ROTATE_DEGREE;

                SWIPE_CARD.style.transform = `rotate(${CARD_ROTATION}deg)`;

                // color main with degree
                const hue = CARD_ROTATION / MAX_ROTATION * 60 - 60;
                const saturation = Math.abs(CARD_ROTATION / MAX_ROTATION * 50);
                const lightness = Math.abs(CARD_ROTATION / MAX_ROTATION * 25);
                console.log(hue, saturation)
                MAIN.style.backgroundColor = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
                // 


            }

            SWIPE_CARD.addEventListener('touchmove', function (e) {
                observeSwipe(e.touches[0].clientX);
            });

            


            function registerSwipeEnd() {
                
                cardHold = false;

                const CURRENT_TRANSFORM = parseInt(SWIPE_CARD.style.transform.split('(')[1].split(')')[0]);
                console.log(CURRENT_TRANSFORM);
                // if the degree is less then 7 degree reset it back to 0
                if (Math.abs(CURRENT_TRANSFORM) < 22) {
                    SWIPE_CARD.style.transform = `rotate(0deg)`;
                    MAIN.style.backgroundColor = `hsl(0, 0%, 0%)`;
                }

                holdTimeEnd = new Date();
                holdTimeTotal = holdTimeEnd - holdTimeStart;
                console.log(holdTimeTotal);
                cardHold = false;
                SWIPE_CARD.style.transform = `rotate(0deg)`;
                MAIN.style.backgroundColor = `hsl(0, 0%, 0%)`;
            }
            SWIPE_CARD.addEventListener('mouseup', function (e) {
                console.log('stopped holding card');
                registerSwipeEnd() 
            
            });

            SWIPE_CARD.addEventListener('touchend', function () {
                console.log('stopped holding card');
                

                registerSwipeEnd() 
                SWIPE_CARD.removeEventListener('mousemove', observeMouseMove);
            
            });
            

                
        });

        const startDate = new Date();
        // startDate.setDate(startDate.getDate() - 1);
        startDate.setHours(startDate.getHours() - 35);
        const dateEnd = new Date();
        //dateEnd.setDate(dateEnd.getDate() + 2);
        dateEnd.setHours(dateEnd.getHours() + 5);
        function showTime() {


            const dateNow = new Date();
            const timeStamp = dateNow.getTime();
            const timeStampEnd = dateEnd.getTime();

            const diff = timeStampEnd - timeStamp;
            const milliseconds = 1000;
            const seconds = 60;
            const minutes = 60;
            const hours = 24;
            const days = 365;

            const secondsLeft = diff / milliseconds;
            const minutesLeft = secondsLeft / seconds;
            const hoursLeft = minutesLeft / minutes;
            const daysLeft = hoursLeft / hours;

            const daysLeftInt = Math.floor(daysLeft);
            const hoursLeftInt = Math.floor(hoursLeft % hours);
            const minutesLeftInt = Math.floor(minutesLeft % minutes);
            const secondsLeftInt = Math.floor(secondsLeft % seconds);

            const secondsLeftString = secondsLeftInt < 10 ? '0' + secondsLeftInt : secondsLeftInt;
            const minutesLeftString = minutesLeftInt < 10 ? '0' + minutesLeftInt : minutesLeftInt;
            const hoursLeftString = hoursLeftInt < 10 ? '0' + hoursLeftInt : hoursLeftInt;
            const daysLeftString = daysLeftInt < 10 ? '0' + daysLeftInt : daysLeftInt;

            const timeLeft = `${daysLeftString} days and ${hoursLeftString}:${minutesLeftString}:${secondsLeftString}`;


            const timeLeftElement = document.querySelector('time-left');
            timeLeftElement.innerText = timeLeft + ' left';


            const elapsed = dateNow - startDate;

            const timeFrame = dateEnd - startDate;


            const progress = elapsed / timeFrame;


            const footer = document.querySelector('footer');
            // Construct a left to right gradient
            footer.style.background = `linear-gradient(to right, #a00a ${progress * 100}%, #eee3 ${progress * 100}%)`;

        }


    </script>
</head>

<body style="display:grid; min-height: 100vh; grid-template-rows: 30px 1fr 30px;">
    <header>
        <output id="statistics" style="display:block; text-align: center;">
            PR = | TM = | SH = | MH =
        </output>
    </header>
    <main>
        <card-space>
            <swipe-card>
                <h1>Card 1</h1>
                <p>Some text</p>
            </swipe-card>


        </card-space>
    </main>
    <footer style="display: flex; justify-content: center;">
        <time-left style="font-size: 1.5em;"></time-left>

    </footer>
</body>

</html>